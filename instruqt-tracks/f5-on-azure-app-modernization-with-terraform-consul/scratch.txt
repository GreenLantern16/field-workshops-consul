echo '
  node_prefix "" {
    policy = "write"
  }
  service_prefix "" {
    policy = "write"
  }
  session_prefix "" {
    policy = "write"
  }
  agent_prefix "" {
    policy = "write"
  }
  query_prefix "" {
    policy = "write"
  }
  operator = "write"' |  consul acl policy create -name anonymous -rules -




# set creds

export CREDS=$(terraform output username):$(terraform output admin_password)

curl -v -sku $CREDS -X POST \
  -H "Content-Type: application/octet-stream" \
  -H "Content-Range: 0-783634/783635" \
  $(terraform output mgmt_url)/mgmt/tm/asm/file-transfer/uploads/asm_policy.xml \
  --data-binary "@templates/asm_policy.xml" | jq .


curl -k -u $CREDS \
  -H "Content-Type: application/json" \
  -X POST $(terraform output mgmt_url)/mgmt/tm/asm/tasks/import-policy \
  -d '{"filename": "f5admin-asm_policy.xml", "name": "WAFPolicy"}'


curl -k -u $CREDS \
  -H "Content-Type: application/json" \
  -X POST $(terraform output mgmt_url)/mgmt/tm/asm/tasks/import-policy \
  -d '{"filename": "asm_policy.xml", "name": "WAFPolicy"}'